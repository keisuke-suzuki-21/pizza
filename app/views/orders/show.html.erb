<% if current_member %>
  <% @page_title = @order.member.name + "さんのカート内情報" %>
<% else %>
  <% @page_title = "カート内情報" %>
<% end %>

<h1><%= @page_title %></h1>
<% "オーダーモデルの合計金額" %>
<% price = 0 %>
<% if @order.products.present? %>
  <% @order.products.each do |product| %>
    商品名：<%= product.mainmenu.name %><br>
    <% if product.size == 0 %>
      <% price = price + product.mainmenu.price - 200 %>
    <% elsif product.size == 2 %>
     <% price = price + product.mainmenu.price + 200 %>
    <% else %>
      <% price = price + product.mainmenu.price %>
    <% end %>
    <% if product.size == 0 %>
      金額：<%= product.mainmenu.price - 200 %><br>
    <% elsif product.size == 2 %>
     金額：<%= product.mainmenu.price + 200 %><br>
    <% else %>
      金額：<%= product.mainmenu.price %><br>
    <% end %>
    <% product.toppings.each do |topping| %>
      <%= topping.name %><%= "    " %><%= topping.price %><br>
      <% price = price + topping.price %>
    <% end %>
    <br>
    <%= link_to "削除", product, method: :delete, data: {confirm: "本当に削除しますか？"} %><br>
    <% @product = Product.find(product.id) %>
    <% @product.price = price %>
    <% @product.save %>
  <% end %>
<% else %>
 <p>カートにメインメニューの情報がありません。</p>
<% end %>

<% if @order.sidemenus.present? %>
  <% @order.sidemenus.each do |sidemenu| %>
  商品名：<%= sidemenu.name %><br>
  金額：<%= sidemenu.price %><br>
  <%= link_to "削除", sidemenu, method: :delete, data: {confirm: "本当に削除しますか？"} %><br>
  <% price = price + sidemenu.price %>
  <% end %>
<% end %>

<h4><%= "合計金額" %></h4>
<h4><%= price %></h4>


<div><%= link_to "注文ボタン", edit_order_path(@order) %></div>

<div><%= link_to "<<メインメニュー一覧へ", mainmenus_path %></div>
<div><%= link_to "<<サイドメニュー一覧へ", sidemenus_path %></div>
